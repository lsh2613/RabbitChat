<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>Chat Rooms</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
<div class="container">

    <div id="header-placeholder"></div>

    <!-- 채팅방 목록 -->
    <div class="api-block" th:if="${chatRooms != null}">
        <h4>전체 채팅방 목록</h4>
        <ul class="list-group">
            <li class="list-group-item" th:each="chatRoom : ${chatRooms}">
                <div>
                    <strong>Chat Room ID:</strong>
                    <span th:text="${chatRoom.chatRoomId}"></span><br>
                </div>
                <strong>Participants:</strong>
                <ul th:id="'members-' + ${chatRoom.chatRoomId}"></ul>
            </li>
        </ul>
    </div>

</div>

<script src="js/header.js"></script>

<script th:inline="javascript">
    const chatRooms = /*[[${chatRooms}]]*/ [];
    const chatRoomIds = chatRooms.map(room => room.chatRoomId);

    chatRoomIds.forEach(chatRoomId => {
        fetch(`/chat-rooms/${chatRoomId}/members`)
            .then(response => response.json())
            .then(members => {
                const membersList = document.getElementById('members-' + chatRoomId);
                members.forEach(member => {
                    const li = document.createElement('li');
                    li.className = 'list-group-item';
                    li.textContent = 'Member ID: ' + member.memberId + ', Username: ' + member.username;
                    membersList.appendChild(li);
                });
            })
            .catch(error => console.error('Error fetching members:', error));
    });
</script>

</body>
</html>