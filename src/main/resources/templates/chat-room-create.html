<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>Chat Room Created</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
<div class="container">

    <div id="header-placeholder"></div>

    <!-- 채팅방 생성 결과 -->
    <div class="api-section">
        <div class="api-block" th:if="${chatRoomCreateRes != null}">
            <h4>채팅방 생성 결과</h4>
            <ul class="list-group mb-3">
                <li class="list-group-item">
                    <strong>Chat Room ID:</strong>
                    <span id="chatRoomId" th:text="${chatRoomCreateRes.chatRoomId}"></span>
                </li>
                <li class="list-group-item">
                    <strong>Member ID:</strong>
                    <span th:text="${chatRoomCreateRes.memberId}"></span>
                </li>
            </ul>

            <!-- 참여자 리스트 출력 -->
            <h4>채팅방 참여자 목록</h4>
            <div id="chatRoomMembersContainer" class="d-none">
                <ul id="chatRoomMembersList" class="list-group"></ul>
            </div>
        </div>
    </div>

</div>

<script src="js/header.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        fetchChatRoomMembers();
    });

    function fetchChatRoomMembers() {
        const chatRoomId = document.getElementById('chatRoomId').innerText;

        fetch(`http://localhost:8080/chat-rooms/${chatRoomId}/members`)
            .then(response => {
                if (!response.ok) throw new Error('참여자 목록 조회에 실패했습니다.');
                return response.json();
            })
            .then(members => {
                const container = document.getElementById('chatRoomMembersContainer');
                const list = document.getElementById('chatRoomMembersList');

                // 초기화
                list.innerHTML = '';

                if (members.length === 0) {
                    list.innerHTML = '<li class="list-group-item">참여자가 없습니다.</li>';
                } else {
                    members.forEach(member => {
                        const listItem = document.createElement('li');
                        listItem.className = 'list-group-item';
                        listItem.innerHTML = `<strong>Member ID:</strong> ${member.memberId} <br> <strong>Username:</strong> ${member.username}`;
                        list.appendChild(listItem);
                    });
                }

                container.classList.remove('d-none');
            })
            .catch(error => {
                alert(error.message);
            });
    }
</script>

</body>

</html>